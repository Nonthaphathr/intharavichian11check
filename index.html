<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏ó‡∏≤‡∏ô‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡∏ß‡∏¥‡πÄ‡∏ä‡∏µ‡∏¢‡∏£‡∏â‡∏±‡∏ô‡∏ó‡πå ‡πë‡πë (V3.0 Strict Rhyme)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600&family=Prompt:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Prompt', 'Sarabun', sans-serif; background-color: #f0f4f8; }
        .kru-bg { background-color: #dbeafe; color: #1e40af; border: 1px solid #93c5fd; }
        .lahu-bg { background-color: #fee2e2; color: #991b1b; border: 1px solid #fca5a5; }
        .syllable-box { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center;
            width: 65px; 
            height: 70px; 
            margin: 6px; 
            border-radius: 8px;
            position: relative;
            transition: all 0.2s;
            background-color: white;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        .empty-box {
            background-color: #f3f4f6;
            border: 2px dashed #d1d5db;
            color: #9ca3af;
        }
        .syllable-word { font-size: 1.1rem; font-weight: 600; margin-bottom: 2px; }
        .syllable-type { font-size: 0.7rem; opacity: 0.8; }
        .badge {
            position: absolute;
            top: -8px;
            right: -15px; 
            color: white;
            font-size: 0.55rem;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            z-index: 10;
            white-space: nowrap; 
            width: max-content;
        }
        .badge-error { background-color: #ef4444; }
        
        .extra-word {
            display: inline-block;
            background-color: #fee2e2;
            color: #b91c1c;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.9rem;
            border: 1px solid #fca5a5;
            margin-right: 4px;
        }
        .logo-shadow { filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1)); }

        /* Button Animation */
        @keyframes pulse-glow {
            0% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.7); transform: scale(1); }
            50% { box-shadow: 0 0 0 10px rgba(99, 102, 241, 0); transform: scale(1.02); }
            100% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0); transform: scale(1); }
        }
        .btn-animate {
            animation: pulse-glow 3s infinite;
        }
        .btn-animate:hover {
            animation: none;
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        #summaryText {
            font-family: 'Sarabun', monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <div class="container max-w-4xl mx-auto p-4 flex-grow">
        
        <div class="bg-white rounded-2xl shadow-sm p-6 mb-6 text-center border border-gray-100 relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-indigo-500 to-purple-600"></div>
            <div class="flex flex-col md:flex-row items-center justify-center gap-6 mb-4">
                <img src="https://img5.pic.in.th/file/secure-sv1/logo-vichakarngo-6.png" alt="Logo" class="w-32 h-auto rounded-lg logo-shadow object-contain">
                <div class="text-left">
                    <h1 class="text-2xl md:text-3xl font-bold text-gray-800">‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏ó‡∏≤‡∏ô‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡∏ß‡∏¥‡πÄ‡∏ä‡∏µ‡∏¢‡∏£‡∏â‡∏±‡∏ô‡∏ó‡πå ‡πë‡πë</h1>
                    <p class="text-gray-500 mt-1">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô‡∏ó‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå (‡∏Ñ‡∏£‡∏∏-‡∏•‡∏´‡∏∏) ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™</p>
                    <div class="mt-2 inline-block bg-purple-50 text-purple-700 text-xs px-3 py-1 rounded-full border border-purple-100 font-medium">
                        ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÇ‡∏î‡∏¢ ‡∏Ñ‡∏£‡∏π‡∏ô‡∏ô‡∏ó‡∏û‡∏±‡∏ó‡∏ò‡πå ‡∏´‡∏¥‡∏£‡∏±‡∏ç‡πÄ‡∏£‡∏∑‡∏≠‡∏á
                    </div>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-2xl shadow-sm p-6 mb-6 border border-gray-100">
            <label class="block text-gray-700 font-bold mb-2 flex flex-col md:flex-row md:items-center justify-between gap-2">
                <span class="flex items-center gap-2 text-lg">üìù ‡∏ß‡∏≤‡∏á‡∏ö‡∏ó‡∏õ‡∏£‡∏∞‡∏û‡∏±‡∏ô‡∏ò‡πå (‡πÅ‡∏¢‡∏Å‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô)</span>
                <span class="text-xs font-normal text-gray-500 bg-gray-100 px-3 py-1 rounded-full">V3.0 (‡πÅ‡∏Å‡πâ‡∏Å‡∏é‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™ ‡πÄ‡∏Å‡∏°!=‡∏•‡∏°)</span>
            </label>
            
            <textarea id="poemInput" rows="6" class="w-full bg-gray-50 border border-gray-200 rounded-xl p-4 text-lg focus:outline-none focus:ring-2 focus:ring-indigo-400 transition placeholder-gray-400 font-medium" placeholder="‡∏ß‡∏≤‡∏á‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡∏ß‡∏¥‡πÄ‡∏ä‡∏µ‡∏¢‡∏£‡∏â‡∏±‡∏ô‡∏ó‡πå ‡πë‡πë ‡∏Ç‡∏≠‡∏á‡∏ó‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡∏ô‡∏µ‡πà
‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á :
‡∏¢‡∏≤‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏™‡∏ö‡∏≤‡∏¢‡πÉ‡∏à
‡∏Å‡πá‡∏§‡∏ó‡∏±‡∏¢‡∏£‡∏∞‡∏£‡∏∑‡πà‡∏ô‡∏ä‡∏π
‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏¥‡∏ï‡∏£‡∏™‡∏¥‡∏´‡∏î‡∏´‡∏π‡πà
‡∏°‡∏¥‡∏•‡∏∞‡∏´‡πà‡∏≤‡∏á ‡∏§ ‡∏´‡∏≤‡∏¢‡∏´‡∏ô‡∏µ"></textarea>
            
            <div class="mt-4 bg-blue-50 border border-blue-200 rounded-lg p-4 shadow-sm">
                <div class="flex items-start gap-3">
                    <div class="mt-1 text-blue-600">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </div>
                    <div class="flex-grow">
                        <h4 class="font-bold text-gray-800 text-sm mb-1">‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏û‡∏¢‡∏≤‡∏á‡∏Ñ‡πå‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏≠‡πà‡∏≤‡∏ô 2 ‡πÅ‡∏ö‡∏ö</h4>
                        <p class="text-sm text-gray-600 leading-relaxed mb-3">
                            ‡∏Å‡∏£‡∏ì‡∏µ‡∏Ñ‡∏≥‡∏ö‡∏≤‡∏á‡∏Ñ‡∏≥‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ 2 ‡πÅ‡∏ö‡∏ö ‡∏à‡∏∂‡∏á‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏≥‡∏Ñ‡∏£‡∏∏ ‡∏Å‡πá‡πÑ‡∏î‡πâ ‡∏Ñ‡∏≥‡∏•‡∏´‡∏∏ ‡∏Å‡πá‡πÑ‡∏î‡πâ ‡πÄ‡∏ä‡πà‡∏ô <b>"‡∏î‡∏∏‡∏à"</b> 
                            <ul class="list-disc ml-5 text-sm text-gray-600 mt-1 mb-2">
                                <li>‡∏ñ‡πâ‡∏≤‡∏•‡∏á‡πÉ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ñ‡∏£‡∏∏ (‡∏≠‡πà‡∏≤‡∏ô‡∏ß‡πà‡∏≤ ‡∏î‡∏∏‡∏î)</li>
                                <li>‡∏ñ‡πâ‡∏≤‡∏•‡∏á‡πÉ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏•‡∏´‡∏∏ ‡∏à‡∏∞‡πÑ‡∏î‡πâ 2 ‡∏Å‡∏£‡∏≠‡∏ö (‡∏≠‡πà‡∏≤‡∏ô‡∏ß‡πà‡∏≤ ‡∏î‡∏∏-‡∏à‡∏∞) <b>‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á</b></li>
                            </ul>
                            <span class="bg-blue-100 text-blue-800 px-2 py-0.5 rounded text-xs font-bold">‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ</span> 
                            <span class="text-sm text-gray-600">‡∏Å‡∏£‡∏ì‡∏µ‡∏à‡∏∞‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö‡∏•‡∏´‡∏∏‡πÉ‡∏´‡πâ <b>‡πÄ‡∏Ñ‡∏≤‡∏∞‡∏ß‡∏£‡∏£‡∏Ñ‡πÅ‡∏¢‡∏Å‡∏Ñ‡∏≥</b> ‡πÄ‡∏ä‡πà‡∏ô <b>‡∏î‡∏∏‡∏à</b> ‡πÄ‡∏õ‡πá‡∏ô <b>‡∏î‡∏∏ ‡∏à</b> ‡∏Å‡πà‡∏≠‡∏ô‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•</span>
                        </p>
                    </div>
                </div>
            </div>

            <div class="flex justify-end mt-6">
                <button onclick="analyzePoem()" class="btn-animate bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-bold py-3 px-8 rounded-full shadow-lg flex items-center gap-3 text-lg cursor-pointer transition">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                    ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏•‡∏á‡∏≤‡∏ô
                </button>
            </div>
        </div>

        <div id="resultArea" class="hidden animate-fade-in-up">
            <div class="flex items-center gap-2 mb-4">
                <div class="w-1.5 h-8 bg-purple-600 rounded-full"></div>
                <h3 class="text-xl font-bold text-gray-800">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</h3>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div class="bg-white p-5 rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition">
                    <h4 class="font-bold text-gray-700 mb-2 border-b border-gray-100 pb-2">‡∏ú‡∏±‡∏á‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö (‡∏Ñ‡∏£‡∏∏-‡∏•‡∏´‡∏∏)</h4>
                    <div id="kruLahuSummary"></div>
                </div>
                <div class="bg-white p-5 rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition">
                    <h4 class="font-bold text-gray-700 mb-2 border-b border-gray-100 pb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏≥ (‡∏Ç‡∏≤‡∏î/‡πÄ‡∏Å‡∏¥‡∏ô)</h4>
                    <div id="wordCountSummary"></div>
                </div>
                <div class="bg-white p-5 rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition">
                    <h4 class="font-bold text-gray-700 mb-2 border-b border-gray-100 pb-2">‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö</h4>
                    <div id="samphusSummary" class="text-sm space-y-2"></div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-xl border border-gray-100 shadow-sm overflow-x-auto hover:shadow-md transition mb-6">
                <div id="visualResult" class="space-y-6 min-w-[600px]"></div>
            </div>

            <div class="bg-gray-50 rounded-xl border border-gray-200 p-6 relative">
                <h4 class="font-bold text-gray-700 mb-3 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd" />
                    </svg>
                    ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
                </h4>
                <div class="bg-white border border-gray-300 rounded-lg p-4 text-sm text-gray-700 font-mono overflow-x-auto" id="summaryText"></div>
                <div class="mt-3 flex justify-end">
                    <button onclick="copySummary()" id="btnCopy" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg text-sm flex items-center gap-2 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" />
                        </svg>
                        ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // 1. CORE LOGIC (Restored from Original & Improved)
        // ==========================================

        function processLeadingConsonants(word) {
            const anamYWords = ['‡∏≠‡∏¢‡πà‡∏≤', '‡∏≠‡∏¢‡∏π‡πà', '‡∏≠‡∏¢‡πà‡∏≤‡∏á', '‡∏≠‡∏¢‡∏≤‡∏Å'];
            for (let w of anamYWords) if (word.startsWith(w.replace(/[‡πà‡πâ‡πä‡πã‡πå]/g, ''))) return '‡∏¢' + word.substring(2);
            if (word.length >= 2 && word.charAt(0) === '‡∏´' && ['‡∏á', '‡∏¢', '‡∏ç', '‡∏£', '‡∏ô', '‡∏•', '‡∏°', '‡∏ß'].includes(word.charAt(1))) return word.substring(1);
            return word;
        }

        function hasAiVowel(word) {
            if (word.includes('‡πÑ') || word.includes('‡πÉ') || word.includes('‡∏±‡∏¢')) return true;
            const specialAiWords = ['‡∏ß‡∏±‡∏¢', '‡∏ä‡∏±‡∏¢', '‡∏†‡∏±‡∏¢', '‡πÑ‡∏ó‡∏¢', '‡∏≠‡∏±‡∏¢', '‡∏Ç‡∏±‡∏¢', '‡∏ô‡∏±‡∏¢', '‡∏•‡∏±‡∏¢', '‡∏™‡∏±‡∏¢', '‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢', '‡∏≠‡∏≤‡∏®‡∏±‡∏¢', '‡∏ß‡∏¥‡∏™‡∏±‡∏¢', '‡∏õ‡∏£‡∏ô‡∏±‡∏¢', '‡∏≠‡∏∏‡∏õ‡∏±‡∏¢', '‡∏ß‡∏¥‡∏ò‡∏±‡∏¢'];
            for (let w of specialAiWords) if (word === w || word.endsWith(w)) return true;
            return false;
        }

        function getFinalConsonantGroup(word) {
            if (hasAiVowel(word)) return '‡πÄ‡∏Å‡∏¢';
            const lastChar = word.charAt(word.length - 1);
            const groups = {
                '‡∏Å‡∏Ç‡∏Ñ‡∏Ü': '‡∏Å‡∏Å', '‡∏à‡∏ä‡∏ã‡∏å‡∏ç‡∏î‡∏ï‡∏ñ‡∏ó‡∏ò‡∏®‡∏©‡∏™‡∏é‡∏è‡∏ê‡∏ë‡∏í': '‡∏Å‡∏î', '‡∏ö‡∏õ‡∏û‡∏ü‡∏†': '‡∏Å‡∏ö',
                '‡∏ô‡∏ì‡∏£‡∏•‡∏¨': '‡∏Å‡∏ô', '‡∏°': '‡∏Å‡∏°', '‡∏á': '‡∏Å‡∏á', '‡∏¢': '‡πÄ‡∏Å‡∏¢', '‡∏ß': '‡πÄ‡∏Å‡∏≠‡∏ß'
            };
            for (let g in groups) if (g.includes(lastChar)) return groups[g];
            return '‡∏Å‡∏Å‡∏≤';
        }

        // --- ‚≠ê V3.0 Strict Vowel Detection ‚≠ê ---
        function getVowelSound(word) {
            // 1. Check complex vowels
            if (hasAiVowel(word)) return '‡πÑ‡∏≠';
            if (word.includes('‡πÄ‡∏≠‡∏µ‡∏¢')) return '‡πÄ‡∏≠‡∏µ‡∏¢';
            if (word.includes('‡πÄ‡∏≠‡∏∑‡∏≠')) return '‡πÄ‡∏≠‡∏∑‡∏≠';
            if (word.includes('‡∏≠‡∏±‡∏ß')) return '‡∏≠‡∏±‡∏ß';
            if (word.includes('‡πÄ‡∏≠‡∏≤‡∏∞')) return '‡πÄ‡∏≠‡∏≤‡∏∞';
            if (word.includes('‡πÄ‡∏≠‡∏≠‡∏∞')) return '‡πÄ‡∏≠‡∏≠‡∏∞';
            if (word.includes('‡πÄ‡∏≠‡∏µ‡∏¢‡∏∞')) return '‡πÄ‡∏≠‡∏µ‡∏¢‡∏∞';
            if (word.includes('‡πÄ‡∏≠‡∏∑‡∏≠‡∏∞')) return '‡πÄ‡∏≠‡∏∑‡∏≠‡∏∞';
            if (word.includes('‡∏≠‡∏±‡∏ß‡∏∞')) return '‡∏≠‡∏±‡∏ß‡∏∞';
            
            if (word.includes('‡∏≠‡∏≥') || word.includes('‡∏≥')) return '‡∏≠‡∏≥';
            if (word.includes('‡πÄ‡∏≠‡∏≤') || (word.includes('‡πÄ') && word.includes('‡∏≤'))) return '‡πÄ‡∏≠‡∏≤';
            
            if (word.includes('‡πÄ‡∏≠‡∏≠')) return '‡πÄ‡∏≠‡∏≠';
            if (word.includes('‡πÅ‡∏≠')) return '‡πÅ‡∏≠';
            if (word.includes('‡πÇ‡∏≠')) return '‡πÇ‡∏≠';
            if (word.includes('‡∏≠‡∏≠')) return '‡∏≠‡∏≠';
            if (word.includes('‡∏≠‡∏∑')) return '‡∏≠‡∏∑';
            if (word.includes('‡∏≠‡∏π')) return '‡∏≠‡∏π';
            if (word.includes('‡∏≠‡∏µ')) return '‡∏≠‡∏µ';
            if (word.includes('‡∏≠‡∏≤') || word.includes('‡∏≤')) return '‡∏≠‡∏≤';
            
            if (word.includes('‡πÄ‡∏≠‡∏∞')) return '‡πÄ‡∏≠‡∏∞';
            if (word.includes('‡πÅ‡∏≠‡∏∞')) return '‡πÅ‡∏≠‡∏∞';
            if (word.includes('‡πÇ‡∏≠‡∏∞')) return '‡πÇ‡∏≠‡∏∞';
            if (word.includes('‡∏≠‡∏∂')) return '‡∏≠‡∏∂';
            if (word.includes('‡∏≠‡∏∏')) return '‡∏≠‡∏∏';
            if (word.includes('‡∏≠‡∏¥')) return '‡∏≠‡∏¥';
            if (word.includes('‡∏≠‡∏∞') || word.includes('‡∏∞') || word.includes('‡∏±')) return '‡∏≠‡∏∞';
            
            // 2. Specific Vowel Form Checks
            if (word.includes('‡πÄ')) return '‡πÄ‡∏≠'; // Game -> 'Eh'
            if (word.includes('‡πÇ')) return '‡πÇ‡∏≠';
            
            // 3. Implicit Vowels (No visible vowel marks)
            // If no vowel markers found, assume Implicit Short O (Sara O) like "‡∏•‡∏°", "‡∏ô‡∏Å"
            const vowels = /[‡∏∞‡∏≤‡∏¥‡∏µ‡∏∂‡∏∑‡∏∏‡∏π‡πÄ‡πÅ‡πÇ‡πÉ‡πÑ‡∏≥‡∏±]/;
            if (!word.match(vowels)) return '‡πÇ‡∏≠‡∏∞'; // Lom -> 'Oh'

            return '‡∏≠‡∏≤'; // Default fallback
        }

        function getVowelAndFinalSound(word) {
            if (!word) return { vowel: '', finalGroup: '' };
            const cleanWord = word.replace(/[‡πà‡πâ‡πä‡πã‡πå]/g, '');
            const processedWord = processLeadingConsonants(cleanWord);
            if (/‡∏£‡∏£[‡∏ñ‡∏ï‡∏©‡∏™‡∏®‡∏î‡∏à‡∏ä‡∏é‡∏è‡∏ê‡∏ë‡∏í‡∏ó‡∏ò]$/.test(processedWord)) return { vowel: '‡∏≠‡∏∞', finalGroup: '‡∏Å‡∏î' };
            if (/‡∏£‡∏£[‡∏Ñ‡∏Å‡∏Ç‡∏Ü]$/.test(processedWord)) return { vowel: '‡∏≠‡∏∞', finalGroup: '‡∏Å‡∏Å' };
            if (/‡∏£‡∏£[‡∏û‡∏†‡∏ö‡∏õ‡∏ü]$/.test(processedWord)) return { vowel: '‡∏≠‡∏∞', finalGroup: '‡∏Å‡∏ö' };
            if (processedWord.endsWith('‡∏£‡∏£‡∏°')) return { vowel: '‡∏≠‡∏≥', finalGroup: '‡∏Å‡∏Å‡∏≤' };
            if (processedWord.endsWith('‡∏£‡∏£')) return { vowel: '‡∏≠‡∏∞', finalGroup: '‡∏Å‡∏ô' };
            if (processedWord.endsWith('‡∏£‡∏£‡∏ì')) return { vowel: '‡∏≠‡∏∞', finalGroup: '‡∏Å‡∏ô' };
            
            // Logic Reuse
            const vowel = getVowelSound(processedWord);
            const finalGroup = getFinalConsonantGroup(processedWord);
            return { vowel, finalGroup };
        }

        function hasEndingConsonant(word) {
            const cleanWord = word.replace(/[‡πà‡πâ‡πä‡πã‡πå]/g, '');
            const processedWord = processLeadingConsonants(cleanWord);
            const finalConsonants = "‡∏Å‡∏Ç‡∏Ñ‡∏Ü‡∏à‡∏ä‡∏ã‡∏å‡∏ç‡∏î‡∏ï‡∏ñ‡∏ó‡∏ò‡∏®‡∏©‡∏™‡∏é‡∏è‡∏ê‡∏ö‡∏õ‡∏ú‡∏ù‡∏û‡∏ü‡∏†‡∏ô‡∏ì‡∏£‡∏•‡∏¨‡∏°‡∏¢‡∏ß‡∏á";
            const lastChar = processedWord.charAt(processedWord.length - 1);
            if (finalConsonants.includes(lastChar)) {
                if (processedWord.length === 1) return false;
                if ("‡πà‡πâ‡πä‡πã‡πå".includes(processedWord.charAt(processedWord.length - 2))) return false;
                return true;
            }
            return false;
        }

        function isLahu(word) {
            if (!word) return false;
            word = word.trim();
            const cleanWord = word.replace(/[‡πà‡πâ‡πä‡πã‡πå]/g, '');
            const processedWord = processLeadingConsonants(cleanWord);
            
            const specialLahu = ["‡∏Å‡πá", "‡∏ö‡πà", "‡∏ì", "‡∏ò", "‡∏à‡∏∞", "‡∏ó‡∏¥", "‡∏õ‡∏¥", "‡∏¢‡∏∞", "‡∏™‡∏¥", "‡∏ò‡∏∏", "‡∏£‡∏∞", "‡∏û‡∏∞", "‡∏°‡∏¥", "‡∏î‡∏∏", "‡πÄ‡∏ï‡∏∞", "‡∏Å‡∏∞", "‡∏ô‡∏¥", "‡∏ú‡∏•‡∏¥", "‡∏•‡∏∏", "‡∏§", "‡∏≠‡∏¥", "‡∏ï‡∏¥", "‡∏≠‡∏∏"];
            if (specialLahu.includes(word)) return true;

            // Priority Check: Ends with '‡∏∞' or '‡πÄ‡∏≠‡∏≤‡∏∞' -> Lahu
            if (processedWord.endsWith("‡∏∞") || processedWord.includes("‡πÄ‡∏≠‡∏≤‡∏∞")) return true;

            // Sara Gern -> Kru
            if (processedWord.includes("‡∏≥") || processedWord.includes("‡πÑ") || processedWord.includes("‡πÉ")) return false; 
            if (processedWord.includes("‡πÄ") && processedWord.includes("‡∏≤")) return false;

            if (hasEndingConsonant(word)) return false;

            const forceKruLongVowels = ["‡∏≤", "‡∏µ", "‡∏∑", "‡∏π", "‡πÄ", "‡πÅ", "‡πÇ", "‡∏≠"];
            let hasLongVowel = false;
            for (let v of forceKruLongVowels) if (processedWord.includes(v)) hasLongVowel = true;

            if (hasLongVowel) {
                const shorteners = ["‡∏∞", "‡πá"];
                let isShortened = false;
                for (let s of shorteners) if (processedWord.includes(s)) isShortened = true;
                if (processedWord.includes("‡πÄ‡∏≠‡∏≤‡∏∞") || processedWord.includes("‡πÄ‡∏≠‡∏≠‡∏∞") || processedWord.includes("‡∏≠‡∏±‡∏ß‡∏∞") || processedWord.includes("‡πÄ‡∏≠‡∏µ‡∏¢‡∏∞")) isShortened = true;
                if (!isShortened) return false; 
            }
            return true; 
        }

        function checkSamphus(word1, word2) {
            if (!word1 || !word2) return false;
            const sound1 = getVowelAndFinalSound(word1);
            const sound2 = getVowelAndFinalSound(word2);
            // Debug log if needed
            // console.log(word1, sound1, word2, sound2);
            return sound1.vowel === sound2.vowel && sound1.finalGroup === sound2.finalGroup;
        }

        // --- 2. TOKENIZER ---
        
        const MANUAL_SPLITS = {
            "‡∏Ñ‡∏¥‡∏î‡∏ñ‡∏∂‡∏á": ["‡∏Ñ‡∏¥‡∏î", "‡∏ñ‡∏∂‡∏á"], "‡∏´‡∏±‡∏ß‡πÉ‡∏à": ["‡∏´‡∏±‡∏ß", "‡πÉ‡∏à"], "‡πÄ‡∏™‡∏µ‡∏¢‡πÉ‡∏à": ["‡πÄ‡∏™‡∏µ‡∏¢", "‡πÉ‡∏à"], "‡∏î‡∏µ‡πÉ‡∏à": ["‡∏î‡∏µ", "‡πÉ‡∏à"],
            "‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à": ["‡πÄ‡∏Ç‡πâ‡∏≤", "‡πÉ‡∏à"], "‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à": ["‡∏°‡∏±‡πà‡∏ô", "‡πÉ‡∏à"], "‡∏†‡∏π‡∏°‡∏¥‡πÉ‡∏à": ["‡∏†‡∏π‡∏°‡∏¥", "‡πÉ‡∏à"], "‡∏™‡∏∏‡∏Ç‡πÉ‡∏à": ["‡∏™‡∏∏‡∏Ç", "‡πÉ‡∏à"],
            "‡∏ó‡∏∏‡∏Å‡∏Ç‡πå‡πÉ‡∏à": ["‡∏ó‡∏∏‡∏Å‡∏Ç‡πå", "‡πÉ‡∏à"], "‡∏ô‡πâ‡∏≠‡∏¢‡πÉ‡∏à": ["‡∏ô‡πâ‡∏≠‡∏¢", "‡πÉ‡∏à"], "‡∏´‡πà‡∏ß‡∏á‡πÉ‡∏¢": ["‡∏´‡πà‡∏ß‡∏á", "‡πÉ‡∏¢"], "‡∏™‡∏ô‡πÉ‡∏à": ["‡∏™‡∏ô", "‡πÉ‡∏à"],
            "‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏à": ["‡∏ï‡∏±‡πâ‡∏á", "‡πÉ‡∏à"], "‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏à": ["‡∏à‡∏£‡∏¥‡∏á", "‡πÉ‡∏à"], "‡πÄ‡∏ï‡πá‡∏°‡πÉ‡∏à": ["‡πÄ‡∏ï‡πá‡∏°", "‡πÉ‡∏à"], "‡∏ß‡∏≤‡∏á‡πÉ‡∏à": ["‡∏ß‡∏≤‡∏á", "‡πÉ‡∏à"],
            "‡∏ô‡πâ‡∏≥‡πÉ‡∏à": ["‡∏ô‡πâ‡∏≥", "‡πÉ‡∏à"], "‡∏£‡πâ‡∏≠‡∏á‡πÑ‡∏´‡πâ": ["‡∏£‡πâ‡∏≠‡∏á", "‡πÑ‡∏´‡πâ"], "‡∏´‡∏±‡∏ß‡πÄ‡∏£‡∏≤‡∏∞": ["‡∏´‡∏±‡∏ß", "‡πÄ‡∏£‡∏≤‡∏∞"], "‡∏¢‡∏¥‡πâ‡∏°‡πÅ‡∏¢‡πâ‡∏°": ["‡∏¢‡∏¥‡πâ‡∏°", "‡πÅ‡∏¢‡πâ‡∏°"],
            "‡∏™‡∏î‡πÉ‡∏™": ["‡∏™‡∏î", "‡πÉ‡∏™"], "‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï": ["‡∏ä‡∏µ", "‡∏ß‡∏¥‡∏ï"], "‡∏ä‡∏µ‡∏ß‡∏≤": ["‡∏ä‡∏µ", "‡∏ß‡∏≤"], "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å": ["‡∏Ñ‡∏ß‡∏≤‡∏°", "‡∏£‡∏±‡∏Å"],
            "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç": ["‡∏Ñ‡∏ß‡∏≤‡∏°", "‡∏™‡∏∏‡∏Ç"], "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏∏‡∏Å‡∏Ç‡πå": ["‡∏Ñ‡∏ß‡∏≤‡∏°", "‡∏ó‡∏∏‡∏Å‡∏Ç‡πå"], "‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô": ["‡πÇ‡∏£‡∏á", "‡πÄ‡∏£‡∏µ‡∏¢‡∏ô"],
            "‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô": ["‡∏´‡πâ‡∏≠‡∏á", "‡πÄ‡∏£‡∏µ‡∏¢‡∏ô"], "‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô": ["‡∏ô‡∏±‡∏Å", "‡πÄ‡∏£‡∏µ‡∏¢‡∏ô"], "‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏π": ["‡∏Ñ‡∏∏‡∏ì", "‡∏Ñ‡∏£‡∏π"],
            "‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå": ["‡∏≠‡∏≤", "‡∏à‡∏≤‡∏£‡∏¢‡πå"], "‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠": ["‡∏´‡∏ô‡∏±‡∏á", "‡∏™‡∏∑‡∏≠"], "‡∏õ‡∏≤‡∏Å‡∏Å‡∏≤": ["‡∏õ‡∏≤‡∏Å", "‡∏Å‡∏≤"], "‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô": ["‡∏Å‡∏≤‡∏£", "‡∏ö‡πâ‡∏≤‡∏ô"],
            "‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö": ["‡∏Ç‡πâ‡∏≠", "‡∏™‡∏≠‡∏ö"], "‡∏ü‡∏∏‡∏ï‡∏ö‡∏≠‡∏•": ["‡∏ü‡∏∏‡∏ï", "‡∏ö‡∏≠‡∏•"], "‡∏Å‡∏µ‡∏¨‡∏≤": ["‡∏Å‡∏µ", "‡∏¨‡∏≤"], "‡∏î‡∏ô‡∏ï‡∏£‡∏µ": ["‡∏î‡∏ô", "‡∏ï‡∏£‡∏µ"],
            "‡∏®‡∏¥‡∏•‡∏õ‡∏∞": ["‡∏®‡∏¥‡∏•", "‡∏õ‡∏∞"], "‡∏ß‡∏¥‡∏ä‡∏≤": ["‡∏ß‡∏¥", "‡∏ä‡∏≤"], "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ": ["‡∏Ñ‡∏ß‡∏≤‡∏°", "‡∏£‡∏π‡πâ"], "‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ù‡∏π‡∏á": ["‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô", "‡∏ù‡∏π‡∏á"],
            "‡∏≠‡∏∞‡πÑ‡∏£": ["‡∏≠‡∏∞", "‡πÑ‡∏£"], "‡∏ó‡∏≥‡πÑ‡∏°": ["‡∏ó‡∏≥", "‡πÑ‡∏°"], "‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏£": ["‡πÄ‡∏°‡∏∑‡πà‡∏≠", "‡πÑ‡∏£"], "‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£": ["‡πÄ‡∏ó‡πà‡∏≤", "‡πÑ‡∏£"],
            "‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£": ["‡∏≠‡∏¢‡πà‡∏≤‡∏á", "‡πÑ‡∏£"], "‡πÉ‡∏Ñ‡∏£‡πÉ‡∏Ñ‡∏£": ["‡πÉ‡∏Ñ‡∏£", "‡πÉ‡∏Ñ‡∏£"], "‡πÉ‡∏î‡πÉ‡∏î": ["‡πÉ‡∏î", "‡πÉ‡∏î"], "‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ": ["‡∏ó‡∏±‡πà‡∏ß", "‡πÑ‡∏õ"],
            "‡∏Å‡πâ‡∏≤‡∏ß‡∏´‡∏ô‡πâ‡∏≤": ["‡∏Å‡πâ‡∏≤‡∏ß", "‡∏´‡∏ô‡πâ‡∏≤"], "‡∏Å‡πâ‡∏≤‡∏ß‡πÑ‡∏Å‡∏•": ["‡∏Å‡πâ‡∏≤‡∏ß", "‡πÑ‡∏Å‡∏•"], "‡∏´‡∏ß‡∏±‡πà‡∏ô‡πÑ‡∏´‡∏ß": ["‡∏´‡∏ß‡∏±‡πà‡∏ô", "‡πÑ‡∏´‡∏ß"], "‡∏≠‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß": ["‡∏≠‡πà‡∏≠‡∏ô", "‡πÑ‡∏´‡∏ß"],
            "‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏°‡πÉ‡∏™": ["‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏°", "‡πÉ‡∏™"], "‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™": ["‡πÇ‡∏õ‡∏£‡πà‡∏á", "‡πÉ‡∏™"], "‡∏™‡∏∏‡∏Å‡πÉ‡∏™": ["‡∏™‡∏∏‡∏Å", "‡πÉ‡∏™"], "‡∏≠‡∏≥‡πÑ‡∏û": ["‡∏≠‡∏≥", "‡πÑ‡∏û"],
            "‡∏ß‡∏¥‡πÑ‡∏•": ["‡∏ß‡∏¥", "‡πÑ‡∏•"], "‡πÄ‡∏â‡πÑ‡∏•": ["‡πÄ‡∏â", "‡πÑ‡∏•"], "‡∏£‡πà‡∏≥‡πÑ‡∏£": ["‡∏£‡πà‡∏≥", "‡πÑ‡∏£"], "‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç": ["‡πÅ‡∏Å‡πâ", "‡πÑ‡∏Ç"],
            "‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç": ["‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô", "‡πÑ‡∏Ç"], "‡∏Å‡∏•‡πâ‡∏ß‡∏¢‡πÑ‡∏°‡πâ": ["‡∏Å‡∏•‡πâ‡∏ß‡∏¢", "‡πÑ‡∏°‡πâ"], "‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ": ["‡∏ï‡πâ‡∏ô", "‡πÑ‡∏°‡πâ"], "‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ": ["‡∏î‡∏≠‡∏Å", "‡πÑ‡∏°‡πâ"],
            "‡∏ú‡∏•‡πÑ‡∏°‡πâ": ["‡∏ú‡∏•", "‡πÑ‡∏°‡πâ"], "‡∏£‡∏ñ‡πÑ‡∏ü": ["‡∏£‡∏ñ", "‡πÑ‡∏ü"], "‡πÑ‡∏ü‡∏ü‡πâ‡∏≤": ["‡πÑ‡∏ü", "‡∏ü‡πâ‡∏≤"],
            "‡∏™‡∏ö‡∏≤‡∏¢": ["‡∏™‡∏∞", "‡∏ö‡∏≤‡∏¢"], "‡∏™‡∏ô‡∏∏‡∏Å": ["‡∏™‡∏∞", "‡∏ô‡∏∏‡∏Å"], "‡∏™‡∏á‡∏ö": ["‡∏™‡∏∞", "‡∏á‡∏ö"], "‡∏™‡∏ß‡πà‡∏≤‡∏á": ["‡∏™‡∏∞", "‡∏ß‡πà‡∏≤‡∏á"],
            "‡πÑ‡∏™‡∏ß": ["‡∏™‡∏∞", "‡πÑ‡∏´‡∏ß"], "‡∏â‡∏•‡∏≤‡∏î": ["‡∏â‡∏∞", "‡∏´‡∏•‡∏≤‡∏î"], "‡∏ï‡∏•‡∏≤‡∏î": ["‡∏ï‡∏∞", "‡∏´‡∏•‡∏≤‡∏î"], "‡∏ï‡∏•‡∏Å": ["‡∏ï‡∏∞", "‡∏´‡∏•‡∏Å"],
            "‡∏ï‡∏•‡∏≠‡∏î": ["‡∏ï‡∏∞", "‡∏´‡∏•‡∏≠‡∏î"], "‡∏à‡∏£‡∏ß‡∏î": ["‡∏à‡∏∞", "‡∏£‡∏ß‡∏î"], "‡∏Ç‡∏ô‡∏°": ["‡∏Ç‡∏∞", "‡∏´‡∏ô‡∏°"], "‡∏ñ‡∏ô‡∏ô": ["‡∏ñ‡∏∞", "‡∏´‡∏ô‡∏ô"],
            "‡∏™‡∏¢‡∏≤‡∏°": ["‡∏™‡∏∞", "‡∏´‡∏¢‡∏≤‡∏°"], "‡∏™‡∏•‡∏ß‡∏¢": ["‡∏™‡∏∞", "‡∏•‡∏ß‡∏¢"], "‡πÄ‡∏™‡∏°‡∏∑‡∏≠‡∏ô": ["‡∏™‡∏∞", "‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô"], "‡∏™‡∏ñ‡∏≤‡∏ô": ["‡∏™‡∏∞", "‡∏ñ‡∏≤‡∏ô"],
            "‡∏™‡∏ñ‡∏¥‡∏ï": ["‡∏™‡∏∞", "‡∏ñ‡∏¥‡∏î"], "‡∏™‡∏†‡∏≤‡∏û": ["‡∏™‡∏∞", "‡∏†‡∏≤‡∏û"], "‡πÄ‡∏â‡∏û‡∏≤‡∏∞": ["‡∏â‡∏∞", "‡πÄ‡∏û‡∏≤‡∏∞"], "‡πÄ‡∏ú‡∏≠‡∏¥‡∏ç": ["‡∏ú‡∏∞", "‡πÄ‡∏≠‡∏¥‡∏ç"],
            "‡∏ä‡∏≥‡∏ô‡∏≤‡∏ç": ["‡∏ä‡∏≥", "‡∏ô‡∏≤‡∏ç"], "‡∏£‡∏≥‡∏Ñ‡∏≤‡∏ç": ["‡∏£‡∏≥", "‡∏Ñ‡∏≤‡∏ç"], "‡∏™‡∏≥‡∏£‡∏≤‡∏ç": ["‡∏™‡∏≥", "‡∏£‡∏≤‡∏ç"], "‡∏ß‡∏¥‡∏ç‡∏ç‡∏≤‡∏ì": ["‡∏ß‡∏¥‡∏ô", "‡∏¢‡∏≤‡∏ô"],
            "‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì": ["‡∏™‡∏±‡∏ô", "‡∏¢‡∏≤‡∏ô"], "‡∏ö‡∏±‡∏ô‡∏î‡∏≤‡∏•": ["‡∏ö‡∏±‡∏ô", "‡∏î‡∏≤‡∏•"], "‡∏ö‡∏±‡∏ô‡πÑ‡∏î": ["‡∏ö‡∏±‡∏ô", "‡πÑ‡∏î"], "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å": ["‡∏ö‡∏±‡∏ô", "‡∏ó‡∏∂‡∏Å"],
            "‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå": ["‡∏™‡∏∞", "‡∏´‡∏ß‡∏±‡∏ô"], "‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå": ["‡∏™‡∏£‡πâ‡∏≤‡∏á", "‡∏™‡∏£‡∏£‡∏Ñ‡πå"], "‡∏°‡∏´‡∏±‡∏®‡∏à‡∏£‡∏£‡∏¢‡πå": ["‡∏°‡∏∞", "‡∏´‡∏±‡∏î", "‡∏™‡∏∞", "‡∏à‡∏±‡∏ô"],
            "‡∏≠‡∏±‡∏®‡∏à‡∏£‡∏£‡∏¢‡πå": ["‡∏≠‡∏±‡∏î", "‡∏™‡∏∞", "‡∏à‡∏±‡∏ô"], "‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå": ["‡∏™‡∏±‡∏°", "‡∏û‡∏±‡∏ô"], "‡∏ú‡∏π‡∏Å‡∏û‡∏±‡∏ô": ["‡∏ú‡∏π‡∏Å", "‡∏û‡∏±‡∏ô"], "‡∏õ‡∏£‡∏∞‡∏û‡∏±‡∏ô‡∏ò‡πå": ["‡∏õ‡∏£‡∏∞", "‡∏û‡∏±‡∏ô‡∏ò‡πå"],
            "‡∏£‡∏±‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå": ["‡∏£‡∏±‡∏á", "‡∏™‡∏£‡∏£‡∏Ñ‡πå"], "‡∏™‡∏±‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå": ["‡∏™‡∏±‡∏á", "‡∏™‡∏£‡∏£‡∏Ñ‡πå"],
            "‡∏ó‡πâ‡∏≠‡∏á‡∏ü‡πâ‡∏≤": ["‡∏ó‡πâ‡∏≠‡∏á", "‡∏ü‡πâ‡∏≤"], "‡πÅ‡∏™‡∏á‡πÅ‡∏î‡∏î": ["‡πÅ‡∏™‡∏á", "‡πÅ‡∏î‡∏î"], "‡∏™‡∏≤‡∏¢‡∏•‡∏°": ["‡∏™‡∏≤‡∏¢", "‡∏•‡∏°"], "‡∏™‡∏≤‡∏¢‡∏ù‡∏ô": ["‡∏™‡∏≤‡∏¢", "‡∏ù‡∏ô"],
            "‡∏î‡∏ß‡∏á‡∏î‡∏≤‡∏ß": ["‡∏î‡∏ß‡∏á", "‡∏î‡∏≤‡∏ß"], "‡∏†‡∏π‡πÄ‡∏Ç‡∏≤": ["‡∏†‡∏π", "‡πÄ‡∏Ç‡∏≤"], "‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥": ["‡πÅ‡∏°‡πà", "‡∏ô‡πâ‡∏≥"], "‡∏ó‡∏∞‡πÄ‡∏•": ["‡∏ó‡∏∞", "‡πÄ‡∏•"],
            "‡πÄ‡∏ß‡∏•‡∏≤": ["‡πÄ‡∏ß", "‡∏•‡∏≤"], "‡∏ô‡∏≤‡∏ó‡∏µ": ["‡∏ô‡∏≤", "‡∏ó‡∏µ"], "‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á": ["‡∏ä‡∏±‡πà‡∏ß", "‡πÇ‡∏°‡∏á"], "‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ": ["‡∏ß‡∏±‡∏ô", "‡∏ô‡∏µ‡πâ"],
            "‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ": ["‡∏û‡∏£‡∏∏‡πà‡∏á", "‡∏ô‡∏µ‡πâ"], "‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏ô": ["‡πÄ‡∏°‡∏∑‡πà‡∏≠", "‡∏ß‡∏≤‡∏ô"], "‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà": ["‡∏õ‡∏µ", "‡πÉ‡∏´‡∏°‡πà"], "‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå": ["‡∏™‡∏á", "‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå"],
            "‡∏õ‡∏±‡∏ç‡∏´‡∏≤": ["‡∏õ‡∏±‡∏ô", "‡∏´‡∏≤"], "‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à": ["‡∏™‡∏≥", "‡πÄ‡∏£‡πá‡∏à"], "‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß": ["‡∏•‡πâ‡∏°", "‡πÄ‡∏´‡∏•‡∏ß"], "‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ": ["‡πÇ‡∏ä‡∏Ñ", "‡∏î‡∏µ"],
            "‡πÇ‡∏ä‡∏Ñ‡∏£‡πâ‡∏≤‡∏¢": ["‡πÇ‡∏ä‡∏Ñ", "‡∏£‡πâ‡∏≤‡∏¢"], "‡πÇ‡∏≠‡∏Å‡∏≤‡∏™": ["‡πÇ‡∏≠", "‡∏Å‡∏≤‡∏™"], "‡∏û‡∏±‡∏í‡∏ô‡∏≤": ["‡∏û‡∏±‡∏ó", "‡∏ó‡∏∞", "‡∏ô‡∏≤"], "‡∏®‡∏∂‡∏Å‡∏©‡∏≤": ["‡∏®‡∏∂‡∏Å", "‡∏©‡∏≤"],
            "‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ": ["‡πÄ‡∏£‡∏µ‡∏¢‡∏ô", "‡∏£‡∏π‡πâ"], "‡∏≠‡∏ö‡∏£‡∏°": ["‡∏≠‡∏ö", "‡∏£‡∏°"], "‡∏î‡∏π‡πÅ‡∏•": ["‡∏î‡∏π", "‡πÅ‡∏•"], "‡∏£‡∏±‡∏Å‡∏©‡∏≤": ["‡∏£‡∏±‡∏Å", "‡∏©‡∏≤"],
            "‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô": ["‡∏õ‡πâ‡∏≠‡∏á", "‡∏Å‡∏±‡∏ô"], "‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï": ["‡πÄ‡∏ï‡∏¥‡∏ö", "‡πÇ‡∏ï"], "‡∏™‡∏Å‡∏±‡∏î": ["‡∏™‡∏∞", "‡∏Å‡∏±‡∏î"], "‡∏™‡∏•‡∏±‡∏î": ["‡∏™‡∏∞", "‡∏•‡∏±‡∏î"],
            "‡∏Ç‡∏à‡∏±‡∏î": ["‡∏Ç‡∏∞", "‡∏à‡∏±‡∏î"], "‡∏ñ‡∏ô‡∏±‡∏î": ["‡∏ñ‡∏∞", "‡∏´‡∏ô‡∏±‡∏î"], "‡∏â‡∏ö‡∏±‡∏ö": ["‡∏â‡∏∞", "‡∏ö‡∏±‡∏ö"], "‡∏™‡∏î‡∏±‡∏ö": ["‡∏™‡∏∞", "‡∏î‡∏±‡∏ö"],
            "‡∏™‡∏•‡∏±‡∏ö": ["‡∏™‡∏∞", "‡∏•‡∏±‡∏ö"], "‡∏Ç‡∏¢‡∏±‡∏ö": ["‡∏Ç‡∏∞", "‡∏´‡∏¢‡∏±‡∏ö"], "‡∏ï‡∏ß‡∏±‡∏î": ["‡∏ï‡∏∞", "‡∏´‡∏ß‡∏±‡∏î"]
        };

        function tokenizeLine(lineText) {
            lineText = lineText.replace(/[^\u0E00-\u0E7F\s]/g, " ");
            const segmenter = new Intl.Segmenter('th', { granularity: 'word' });
            const rawWords = Array.from(segmenter.segment(lineText)).filter(s => s.isWordLike).map(s => s.segment.trim());
            
            let finalSyllables = [];
            const TRUE_CLUSTERS = ['‡∏Å‡∏£', '‡∏Å‡∏•', '‡∏Å‡∏ß', '‡∏Ç‡∏£', '‡∏Ç‡∏•', '‡∏Ç‡∏ß', '‡∏Ñ‡∏£', '‡∏Ñ‡∏•', '‡∏Ñ‡∏ß', '‡∏ï‡∏£', '‡∏õ‡∏£', '‡∏õ‡∏•', '‡∏ú‡∏•', '‡∏û‡∏•', '‡∏û‡∏£'];

            rawWords.forEach(word => {
                if (MANUAL_SPLITS[word]) {
                    finalSyllables.push(...MANUAL_SPLITS[word]);
                    return;
                }

                if (word.length === 4 && word.charAt(2) === '‡∏±') {
                    const c1 = word.charAt(0);
                    const c2 = word.charAt(1);
                    const clusterCheck = c1 + c2;
                    if (c1 !== '‡∏´' && !(c1 === '‡∏≠' && c2 === '‡∏¢') && !TRUE_CLUSTERS.includes(clusterCheck)) {
                        finalSyllables.push(word.charAt(0)); 
                        finalSyllables.push(word.substring(1));
                        return;
                    }
                }

                const piyaPattern = /^([‡∏Å-‡∏Æ][‡∏¥‡∏∏][‡∏Å-‡∏Æ]‡∏∞)$/;
                if (word.match(piyaPattern)) {
                    finalSyllables.push(word.substring(0,2), word.substring(2));
                    return;
                }
                const maliPattern = /^([‡∏Å-‡∏Æ]‡∏∞[‡∏Å-‡∏Æ][‡∏¥‡∏∏‡∏∞]?)$/;
                if (word.length > 2 && word.match(maliPattern)) {
                     finalSyllables.push(word.substring(0,2), word.substring(2));
                     return;
                }
                if (word.length > 2) {
                    let splitIndices = [];
                    for(let i=1; i<word.length; i++) if ("‡πÄ‡πÅ‡πÇ‡πÉ‡πÑ".includes(word[i])) splitIndices.push(i);
                    if (splitIndices.length > 0) {
                        let lastIdx = 0;
                        splitIndices.forEach(idx => {
                            finalSyllables.push(word.substring(lastIdx, idx));
                            lastIdx = idx;
                        });
                        finalSyllables.push(word.substring(lastIdx));
                    } else {
                        finalSyllables.push(word);
                    }
                } else {
                    finalSyllables.push(word);
                }
            });
            return finalSyllables;
        }

        // --- 3. MAIN LOGIC ---

        const PATTERN_STANZA = [
            ['K', 'K', 'L', 'K', 'K'],          
            ['L', 'L', 'K', 'L', 'K', 'K'],     
            ['K', 'K', 'L', 'K', 'K'],          
            ['L', 'L', 'K', 'L', 'K', 'K']      
        ];

        let summaryData = "";

        function analyzePoem() {
            const input = document.getElementById('poemInput').value;
            if(!input.trim()) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ß‡∏≤‡∏á‡∏ö‡∏ó‡∏õ‡∏£‡∏∞‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö");

            let rawLines = input.split(/\r?\n/).map(l => l.trim()).filter(l => l !== '');
            let mode = 1;
            if (rawLines.length > 6) mode = 2; 

            let currentPattern = (mode === 1) ? [...PATTERN_STANZA] : [...PATTERN_STANZA, ...PATTERN_STANZA];

            let structuredPoem = [];
            let extraWordsMap = [];

            for(let i = 0; i < currentPattern.length; i++) {
                let requiredPattern = currentPattern[i]; 
                let targetCount = requiredPattern.length;
                
                let userLineSyllables = [];
                if (i < rawLines.length) {
                    userLineSyllables = tokenizeLine(rawLines[i]);
                }

                let mainWords = [];
                let extraWords = [];

                if (userLineSyllables.length <= targetCount) {
                    mainWords = [...userLineSyllables];
                    while(mainWords.length < targetCount) {
                        mainWords.push("?"); 
                    }
                } else {
                    mainWords = userLineSyllables.slice(0, targetCount);
                    extraWords = userLineSyllables.slice(targetCount);
                }

                structuredPoem.push(mainWords);
                extraWordsMap.push(extraWords);
            }

            let rhymePairs = [
                { from: [0, 4], to: [1, 2], name: '‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ß‡∏£‡∏£‡∏Ñ (‡∏ö‡∏ó 1)' },
                { from: [1, 5], to: [2, 4], name: '‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ö‡∏≤‡∏ó (‡∏ö‡∏ó 1)' }
            ];
            if (mode === 2) {
                rhymePairs.push(
                    { from: [3, 5], to: [5, 5], name: '‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ö‡∏ó' },
                    { from: [4, 4], to: [5, 2], name: '‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ß‡∏£‡∏£‡∏Ñ (‡∏ö‡∏ó 2)' },
                    { from: [5, 5], to: [6, 4], name: '‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ö‡∏≤‡∏ó (‡∏ö‡∏ó 2)' }
                );
            }

            renderResult(structuredPoem, extraWordsMap, currentPattern, rhymePairs, mode);
        }

        function renderResult(poem, extraWordsMap, pattern, rhymePairs, mode) {
            const resultArea = document.getElementById('resultArea');
            const visualDiv = document.getElementById('visualResult');
            const kruLahuSummary = document.getElementById('kruLahuSummary');
            const wordCountSummary = document.getElementById('wordCountSummary');
            const samphusSummary = document.getElementById('samphusSummary');
            const summaryTextBox = document.getElementById('summaryText');
            
            visualDiv.innerHTML = '';
            resultArea.classList.remove('hidden');

            let errorKruLahuCount = 0;
            let missingWordCount = 0;
            let extraWordCount = 0;
            let samphusPassCount = 0;
            let samphusFailCount = 0;
            
            poem.forEach((verse, vIndex) => {
                const verseDiv = document.createElement('div');
                verseDiv.className = "flex flex-col md:flex-row md:items-center mb-6 border-b border-gray-100 pb-4";
                
                const label = document.createElement('div');
                label.className = "w-24 text-xs text-gray-500 font-bold uppercase tracking-wider mb-2 md:mb-0 flex-shrink-0";
                label.innerText = `‡∏ß‡∏£‡∏£‡∏Ñ ${vIndex + 1}`;
                verseDiv.appendChild(label);

                const contentContainer = document.createElement('div');
                contentContainer.className = "flex flex-wrap items-center gap-2";

                verse.forEach((word, wIndex) => {
                    const expected = pattern[vIndex][wIndex]; 
                    const box = document.createElement('div');
                    
                    if(word === '?') {
                         box.className = "syllable-box empty-box";
                         box.innerHTML = `<span class="text-sm font-bold">‡∏Ç‡∏≤‡∏î</span>`;
                         missingWordCount++;
                    } else {
                        const isLahuWord = isLahu(word);
                        const actual = isLahuWord ? 'L' : 'K';
                        let bgClass = actual === 'K' ? 'kru-bg' : 'lahu-bg';
                        let isError = false;

                        if (expected === actual) {
                            box.className = `syllable-box ${bgClass}`;
                        } else {
                            box.className = `syllable-box bg-white border-2 border-red-500 text-red-600`;
                            isError = true;
                            errorKruLahuCount++;
                        }

                        const fixLabel = expected === 'K' ? '‡πÅ‡∏Å‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏£‡∏∏' : '‡πÅ‡∏Å‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏´‡∏∏';

                        box.innerHTML = `
                            <span class="syllable-word">${word}</span>
                            <span class="syllable-type">${actual==='K'?'‡∏Ñ‡∏£‡∏∏':'‡∏•‡∏´‡∏∏'}</span>
                            ${isError ? `<span class="badge badge-error">${fixLabel}</span>` : ''}
                        `;
                    }
                    contentContainer.appendChild(box);
                });

                const extras = extraWordsMap[vIndex];
                if (extras && extras.length > 0) {
                    const extraContainer = document.createElement('div');
                    extraContainer.className = "ml-4 pl-4 border-l-2 border-red-200";
                    extraContainer.innerHTML = `<span class="text-xs text-red-500 font-bold block mb-1">‡∏Ñ‡∏≥‡πÄ‡∏Å‡∏¥‡∏ô:</span>`;
                    extras.forEach(w => {
                        extraWordCount++;
                        const sp = document.createElement('span');
                        sp.className = "extra-word";
                        sp.innerText = w;
                        extraContainer.appendChild(sp);
                    });
                    contentContainer.appendChild(extraContainer);
                }
                
                verseDiv.appendChild(contentContainer);
                visualDiv.appendChild(verseDiv);

                if (mode === 2 && vIndex === 3) {
                    const sep = document.createElement('div');
                    sep.className = "w-full border-b-2 border-dashed border-gray-300 my-6 text-center leading-none";
                    sep.innerHTML = "<span class='bg-gray-100 px-2 text-xs text-gray-500'>‡∏à‡∏ö ‡∏ö‡∏ó‡∏ó‡∏µ‡πà 1</span>";
                    visualDiv.appendChild(sep);
                }
            });

            let rhymeHTML = '';
            let rhymeSummaryText = '';
            rhymePairs.forEach(pair => {
                const w1 = poem[pair.from[0]]?.[pair.from[1]];
                const w2 = poem[pair.to[0]]?.[pair.to[1]];

                if(w1 && w2 && w1 !== '?' && w2 !== '?') {
                    const isRhyme = checkSamphus(w1, w2);
                    if(isRhyme) {
                        samphusPassCount++;
                        rhymeHTML += `<div class="flex items-center text-green-700 bg-green-50 p-2 rounded-lg border border-green-100 mb-1">
                            <span class="mr-2">‚úÖ</span> 
                            <span class="text-xs font-bold mr-2 border border-green-200 px-1 rounded text-green-600">${pair.name}</span>
                            <span><b>${w1}</b> - <b>${w2}</b></span>
                        </div>`;
                        rhymeSummaryText += `   - ${pair.name}: ‡∏ú‡πà‡∏≤‡∏ô (${w1}-${w2})\n`;
                    } else {
                        samphusFailCount++;
                        rhymeHTML += `<div class="flex items-center text-red-700 bg-red-50 p-2 rounded-lg border border-red-100 mb-1">
                            <span class="mr-2">‚ùå</span> 
                             <span class="text-xs font-bold mr-2 border border-red-200 px-1 rounded text-red-500">${pair.name}</span>
                            <span><b>${w1}</b> - <b>${w2}</b></span>
                        </div>`;
                        rhymeSummaryText += `   - ${pair.name}: ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô (${w1}-${w2})\n`;
                    }
                } else {
                    rhymeHTML += `<div class="flex items-center text-gray-400 p-2 text-sm mb-1">
                        <span class="mr-2">‚ö™</span> ${pair.name}: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö
                    </div>`;
                    rhymeSummaryText += `   - ${pair.name}: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ (‡∏Ñ‡∏≥‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö)\n`;
                }
            });
            samphusSummary.innerHTML = rhymeHTML;

            if (errorKruLahuCount === 0) {
                kruLahuSummary.innerHTML = `<h2 class="text-3xl font-bold text-green-500">‡∏ú‡πà‡∏≤‡∏ô!</h2><p class="text-gray-500 text-sm">‡∏â‡∏±‡∏ô‡∏ó‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå (‡∏Ñ‡∏£‡∏∏-‡∏•‡∏´‡∏∏) ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</p>`;
            } else {
                kruLahuSummary.innerHTML = `<h2 class="text-3xl font-bold text-red-500">${errorKruLahuCount} ‡∏à‡∏∏‡∏î</h2><p class="text-gray-500 text-sm">‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡∏Ñ‡∏£‡∏∏-‡∏•‡∏´‡∏∏</p>`;
            }

            let wordStatusHTML = '';
            let wordStatusText = '';
            if (missingWordCount === 0 && extraWordCount === 0) {
                wordStatusHTML = `<h2 class="text-3xl font-bold text-green-500">‡∏û‡∏≠‡∏î‡∏µ‡πÄ‡∏õ‡πä‡∏∞</h2><p class="text-gray-500 text-sm">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô</p>`;
                wordStatusText = "‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô";
            } else {
                let msg = [];
                if (missingWordCount > 0) msg.push(`‡∏Ç‡∏≤‡∏î ${missingWordCount} ‡∏Ñ‡∏≥`);
                if (extraWordCount > 0) msg.push(`‡πÄ‡∏Å‡∏¥‡∏ô ${extraWordCount} ‡∏Ñ‡∏≥`);
                wordStatusHTML = `<div class="text-red-600 font-bold text-xl">${msg.join(' / ')}</div>`;
                wordStatusText = msg.join(' ‡πÅ‡∏•‡∏∞ ');
            }
            wordCountSummary.innerHTML = wordStatusHTML;

            // --- Generate Final Summary Text ---
            let finalSummary = "‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡∏ß‡∏¥‡πÄ‡∏ä‡∏µ‡∏¢‡∏£‡∏â‡∏±‡∏ô‡∏ó‡πå ‡πë‡πë\n";
            finalSummary += "--------------------------------\n";
            finalSummary += `[${errorKruLahuCount===0 ? '/' : ' '}] ‡∏ú‡∏±‡∏á‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö (‡∏Ñ‡∏£‡∏∏-‡∏•‡∏´‡∏∏): ${errorKruLahuCount===0 ? '‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á' : '‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ' + errorKruLahuCount + ' ‡∏à‡∏∏‡∏î'}\n`;
            finalSummary += `[${(missingWordCount===0 && extraWordCount===0) ? '/' : ' '}] ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏≥: ${wordStatusText}\n`;
            finalSummary += `[${samphusFailCount===0 ? '/' : ' '}] ‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö: ${samphusFailCount===0 ? '‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î' : '‡∏û‡∏ö‡∏à‡∏∏‡∏î‡∏ú‡∏¥‡∏î ' + samphusFailCount + ' ‡∏à‡∏∏‡∏î'}\n`;
            finalSummary += rhymeSummaryText;
            finalSummary += "--------------------------------\n";
            finalSummary += "(‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÇ‡∏î‡∏¢ ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏ó‡∏≤‡∏ô‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡∏ß‡∏¥‡πÄ‡∏ä‡∏µ‡∏¢‡∏£‡∏â‡∏±‡∏ô‡∏ó‡πå V3.0)";
            
            summaryTextBox.textContent = finalSummary;
            
            resultArea.scrollIntoView({ behavior: 'smooth' });
        }

        function copySummary() {
            const text = document.getElementById('summaryText').textContent;
            navigator.clipboard.writeText(text).then(() => {
                const btn = document.getElementById('btnCopy');
                const originalHTML = btn.innerHTML;
                btn.innerHTML = `<span class="text-green-600">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!</span>`;
                setTimeout(() => btn.innerHTML = originalHTML, 2000);
            });
        }
    </script>
</body>
</html>
